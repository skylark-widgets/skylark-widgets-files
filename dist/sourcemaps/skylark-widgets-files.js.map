{"version":3,"sources":["skylark-widgets-files.js"],"names":["define","skylark","attach","Widget","select","files","ImageChooser","inherit","_construct","parent","prototype","call","this","img","document","createWidget","style","visibility","position","borderStyle","left","top","width","height","objectFit","backgroundImage","Global","FILE_PATH","backgroundRepeat","backgroundSize","_elm","appendChild","value","self","ondragover","preventDefault","ondragstart","ondrop","event","dataTransfer","length","file","Image","fileIsImage","readImageFile","uuid","getData","DragBuffer","get","setValue","onChange","Editor","alert","onclick","picked","reader","FileReader","onload","result","readAsDataURL","setOnChange","cursor","image","src","data","getValue","main"],"mappings":";;;;;;;g4BAAAA,EAAA,+BACA,yBACA,SAAAC,GACA,OAAAA,EAAAC,OAAA,sBAEAF,EAAA,sCACA,8BACA,2BACA,WACA,SACAG,EACAC,EACAC,GAEA,aAUA,IAAAC,EAAAH,EAAAI,SACAC,WAAA,SAAAC,GAEAN,EAAAO,UAAAF,WAAAG,KAAAC,KAAAH,EAAA,OAGAG,KAAAC,IAAAC,SAAAC,aAAA,OACAH,KAAAC,IAAAG,MAAAC,WAAA,UACAL,KAAAC,IAAAG,MAAAE,SAAA,WACAN,KAAAC,IAAAG,MAAAG,YAAA,OACAP,KAAAC,IAAAG,MAAAI,KAAA,MACAR,KAAAC,IAAAG,MAAAK,IAAA,MACAT,KAAAC,IAAAG,MAAAM,MAAA,OACAV,KAAAC,IAAAG,MAAAO,OAAA,OACAX,KAAAC,IAAAG,MAAAQ,UAAA,UACAZ,KAAAC,IAAAG,MAAAS,gBAAA,QAAAC,OAAAC,UAAA,cACAf,KAAAC,IAAAG,MAAAY,iBAAA,SACAhB,KAAAC,IAAAG,MAAAa,eAAA,cACAjB,KAAAkB,KAAAC,YAAAnB,KAAAC,KAGAD,KAAAoB,MAAA,KAEA,IAAAC,EAAArB,KAEAA,KAAAkB,KAAAI,WAAA/B,EAAAgC,eACAvB,KAAAkB,KAAAM,YAAAjC,EAAAgC,eAGAvB,KAAAkB,KAAAO,OAAA,SAAAC,GAIA,GAFAA,EAAAH,iBAEAG,EAAAC,aAAAlC,MAAAmC,OAAA,EACA,CACA,IAAAC,EAAAH,EAAAC,aAAAlC,MAAA,GAEAqC,MAAAC,YAAAF,IAEAG,EAAAH,OAIA,CACA,IAAAI,EAAAP,EAAAC,aAAAO,QAAA,QACAd,EAAAe,WAAAC,IAAAH,GAEAb,aAAAU,OAEAT,EAAAgB,SAAAjB,GACAC,EAAAiB,SAAAlB,IAIAmB,OAAAC,MAAA,0BA3EAxC,KAAAkB,KAAAuB,QAAA,WAEA,OAAApB,EAAAiB,UAEA9C,GACAkD,OAAA,SAAAjD,GACAA,EAAAmC,OAAA,GACAI,EAAAvC,EAAA,QAOA,IAAAuC,EAAA,SAAAH,GAEA,IAAAc,EAAA,IAAAC,WACAD,EAAAE,OAAA,WAEAxB,EAAAgB,SAAA,IAAAP,MAAAa,EAAAG,SACAzB,EAAAiB,SAAAjB,EAAAD,QAEAuB,EAAAI,cAAAlB,IASA7B,KAAAsC,SAAA,MAUAU,YAAA,SAAAV,GAEAtC,KAAAsC,SAAAA,EACAtC,KAAAC,IAAAG,MAAA6C,OAAA,WASAZ,SAAA,SAAAa,GAEAlD,KAAAoB,MAAA8B,EACAlD,KAAAC,IAAAkD,IAAAD,EAAAE,MASAC,SAAA,WACA,OAAArD,KAAAoB,SAKA,OAAA3B,EAAAC,aAAAA,IAEAN,EAAA,8BACA,UACA,kBACA,SAAAK,GACA,OAAAA,IAEAL,EAAA,yBAAA,8BAAA,SAAAkE,GAAA,OAAAA","file":"../skylark-widgets-files.js","sourcesContent":["define('skylark-widgets-files/files',[\r\n\t\"skylark-langx/skylark\"\r\n],function(skylark){\r\n\treturn skylark.attach(\"widgets.files\",{});\r\n});\ndefine('skylark-widgets-files/ImageChooser',[\r\n\t\"skylark-widgets-base/Widget\",\r\n    \"skylark-io-diskfs/select\",\r\n    \"./files\"\r\n],function(\r\n\tWidget,\r\n\tselect,\r\n\tfiles\r\n){\r\n\t\"use strict\";\r\n\r\n\t/**\r\n\t * Image chooser is used for the user to select images.\r\n\t *\r\n\t * Images can be selected by opening a file explorer or by drag and drop.\r\n\t *\r\n\t * @class ImageChooser\r\n\t * @extends {Widget}\r\n\t */\r\n\t var ImageChooser = Widget.inherit({\r\n\t\t\"_construct\" : function (parent)\r\n\t\t{\r\n\t\t\tWidget.prototype._construct.call(this, parent, \"div\");\r\n\r\n\t\t\t//Image\r\n\t\t\tthis.img = document.createWidget(\"img\");\r\n\t\t\tthis.img.style.visibility = \"inherit\";\r\n\t\t\tthis.img.style.position = \"absolute\";\r\n\t\t\tthis.img.style.borderStyle = \"none\";\r\n\t\t\tthis.img.style.left = \"0px\";\r\n\t\t\tthis.img.style.top = \"0px\";\r\n\t\t\tthis.img.style.width = \"100%\";\r\n\t\t\tthis.img.style.height = \"100%\";\r\n\t\t\tthis.img.style.objectFit = \"contain\";\r\n\t\t\tthis.img.style.backgroundImage = \"url(\\\"\" + Global.FILE_PATH + \"alpha.png\\\")\";\r\n\t\t\tthis.img.style.backgroundRepeat = \"repeat\";\r\n\t\t\tthis.img.style.backgroundSize = \"120px 120px\";\r\n\t\t\tthis._elm.appendChild(this.img);\r\n\r\n\t\t\t//Value\r\n\t\t\tthis.value = null;\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis._elm.ondragover = Widget.preventDefault;\r\n\t\t\tthis._elm.ondragstart = Widget.preventDefault;\r\n\r\n\t\t\t//On drop get file dropped\r\n\t\t\tthis._elm.ondrop = function(event)\r\n\t\t\t{\r\n\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\tif(event.dataTransfer.files.length > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar file = event.dataTransfer.files[0];\r\n\r\n\t\t\t\t\tif(Image.fileIsImage(file))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treadImageFile(file);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tvar uuid = event.dataTransfer.getData(\"uuid\");\r\n\t\t\t\t\tvar value = DragBuffer.get(uuid);\r\n\r\n\t\t\t\t\tif(value instanceof Image)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tself.setValue(value);\r\n\t\t\t\t\t\tself.onChange(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tEditor.alert(\"Only images accepted\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t//Onclick select image file\r\n\t\t\tthis._elm.onclick = function()\r\n\t\t\t{\r\n\t\t\t\tif(self.onChange !== null)\r\n\t\t\t\t{\r\n\t\t\t\t\tselect({\r\n\t\t\t\t\t\tpicked : function(files) {\r\n\t\t\t\t\t\t\tif(files.length > 0) {\r\n\t\t\t\t\t\t\t\treadImageFile(files[0]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}   //, \"image/*, .tga\");\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tvar readImageFile = function(file)\r\n\t\t\t{\r\n\t\t\t\tvar reader = new FileReader();\r\n\t\t\t\treader.onload = function()\r\n\t\t\t\t{\r\n\t\t\t\t\tself.setValue(new Image(reader.result));\r\n\t\t\t\t\tself.onChange(self.value);\r\n\t\t\t\t};\r\n\t\t\t\treader.readAsDataURL(file);\r\n\t\t\t};\r\n\r\n\t\t\t/**\r\n\t\t\t * On change callback function.\r\n\t\t\t *\r\n\t\t\t * @property onChange\r\n\t\t\t * @type {Function}\r\n\t\t\t */\r\n\t\t\tthis.onChange = null;\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * Set onchange callback, called after changes.\r\n\t\t *\r\n\t\t * @method setOnChange\r\n\t\t * @param {Function} onChange\r\n\t\t */\r\n\t\tsetOnChange : function(onChange)\r\n\t\t{\r\n\t\t\tthis.onChange = onChange;\r\n\t\t\tthis.img.style.cursor = \"pointer\";\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set value stored in the input element.\r\n\t\t *\r\n\t\t * @method setValue\r\n\t\t * @param {Object} image\r\n\t\t */\r\n\t\tsetValue : function(image)\r\n\t\t{\r\n\t\t\tthis.value = image;\r\n\t\t\tthis.img.src = image.data;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get value stored in the input element.\r\n\t\t *\r\n\t\t * @method setValue\r\n\t\t * @return {Object} Image URL.\r\n\t\t */\r\n\t\tgetValue : function() \t{\r\n\t\t\treturn this.value;\r\n\t\t}\r\n\r\n\t });\r\n\r\n\treturn files.ImageChooser = ImageChooser;\r\n});\ndefine('skylark-widgets-files/main',[\r\n\t\"./files\",\r\n\t\"./ImageChooser\"\r\n],function(files){\r\n\treturn files;\r\n});\ndefine('skylark-widgets-files', ['skylark-widgets-files/main'], function (main) { return main; });\n\n"]}